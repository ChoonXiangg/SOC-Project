---
layout: home
title: FPGA VGA Driver Project
tags: fpga vga verilog
categories: demo
---

Hi, I am Choon Xiang and welcome to my FPGA VGA Driver Project blog. I will be drawing a simplified Straw Hat Pirates logo from the manga and anime One Piece. I will be documenting my progress so read along if you are interested!

## **Template VGA Design**
### **Project Set-Up**

This project has been configured in Vivado to target Artix-7 FPGA (xc7a35tcpg236-1). VGATop is the main parent module that instantiates components for clocking, vga sync to control sync signals and ColourStripes to generate a pattern of changing colours. You are based on data until November 2023. v, VGASync. v, and VGAColourStripes. t that is a testbench module for the simulation source m. Results from synthesis, simulation and implementation affirm that the bitstream was generated successfully, verified as follows in the Project Summary screenshot.

<img src="https://raw.githubusercontent.com/melgineer/fpga-vga-verilog/main/docs/assets/images/VGAPrjSum.png">

### **Template Code**
The example source code produces VGA signals that a common VGA-output monitor would understand. These modules describe the structure of a simple VGA controller. The VGA interface works by driving red, green, blue signals along with sync signals in order to control pixel display. The VGATop. v module connects these elements with a clk_wiz_0 to address timing requirements.
**VGASync.v**
The VGA synchronization module (VGASync.v) is used to generate horizontal (hsync) and vertical sync (vsync) signals based on a timing specification. It also calculates the active video region (vid_on), which determines the pixel output.
### **Simulation**

### **Synthesis**
The diagram illustrates how various components of the design interact. It is the whole pipeline for signal generation. In this our clk_wiz_0 is a clock generation component which modifies the clock signal to the desired frequency (25MHz). The hsync and vsync signals obtained by the VGASync component are used to control the pseudo-synchronization signal of the visualization. The 4 bit output buffers are connected to each of the VGA RGB colors. clk_wiz_0 will receive the input clock signal (clk) and provide 25 MHz clock as output. The VGA Sync module will use the 25 MHz clock and reset signal to produce hsync and vsync. The RGB values are generated by the ColourStripes module.

<img src="https://raw.githubusercontent.com/ChoonXiangg/SOC-Project/refs/heads/main/docs/assets/images/Architecture%20Diagram.png">

<img src="https://raw.githubusercontent.com/ChoonXiangg/SOC-Project/refs/heads/main/docs/assets/images/Architecture%20Diagram%20(1).png">

### **Demonstration
Initially, I wanted to draw an original Straw Hat Pirates logo from the manga and anime One Piece.

<img src="https://raw.githubusercontent.com/ChoonXiangg/SOC-Project/refs/heads/main/docs/assets/images/Straw%20Hat%20Pirates%20Logo.webp">

Unfortunately, as we can see from the image, I think it is too complicated for this project. Thus, I will be simplifying it and hopefully it will be just as nice as the original one and maybe a little cuter.

## **My VGA Design Edit**

### **Code Adaptation**

<img src="https://raw.githubusercontent.com/ChoonXiangg/SOC-Project/refs/heads/main/docs/assets/images/Code.png">

First, I declared the base parameters. They are screen height, screen width, x center, and y center. Since I am displaying graphics on a 640x480 display, the screen height will be 480 and the screen width will be 640. X center will be screen width / 2 and y center will be screen height / 2. I also declared other variables such as left eye x center, right eye x center, eye y center, eye radius, nose y center, and nose radius but I will talk about them later.

Then, I drew its skull by filling a white circle in the middle. First, I declared its radius. I figured 120 will be a good radius since then its diameter will be 240 which is half the screen height. Next, I used a conditional statement to declare the area of it. In fact, how you draw in Verilog is first, you declare the area you want to fill using a conditional statement. Then, you fill it using binarised RGB (Red, Green, and Blue) values of the colour.

<img src="https://raw.githubusercontent.com/ChoonXiangg/SOC-Project/refs/heads/main/docs/assets/images/Code%20(1).png">

This is how I declared its boundaries. Imagine a circle with a center of (0, 0), we can declare any point on the circle as (x, y). Then, we draw a right triangle. We do that by connecting the point to the center and name it c. c will be the hypotenuse of the triangle. After that, we connect the point perpendicularly to the x axis and name it a. Afterwards, we connect the point's x intercept to the center and name it b. Since a is perpendicular to b, this is a right triangle. We know that the length of a, b, and c is y, x, and the radius. Based on Pythagorean Theorem, we know that a^2 + b^2 = c^2. We can substitute it to x^2 + y^2 = r^2. This means that if x^2 + y^2 < r^2, the point is within the triangle, thus also within the circle. It may seem like we only declared the boundary of a triangle instead of a circle. This is where the way FPGA VGA draws comes in. It will start from the upper left most pixel (0, 0), fill it's colour, move to the right, and repeat until it reaches the right most pixel. Subsequently, it will move down and to the left most pixel, and repeat. It repeats until every pixel is filled. Thus, instead of only declaring a point, it will declare every point on the circle, drawing theoretically infinite amount of right triangle in the circle. Therefore, we are not only declaring the boundary of a triangle, but the boundary of the circle instead. Finally, substitute row - y center to y and col to x center to x and we get the condition.  

Next, I drew its hat. I started by filling the top half of the circle dark yellow.

<img src="https://raw.githubusercontent.com/ChoonXiangg/SOC-Project/refs/heads/main/docs/assets/images/Code%20(2).png">

This is quite simple. row < y center just means the upper half of the screen. Note that it has to be within the conditional statement of the circle. Otherwise, the whole upper half of the screen will be filled dark yellow.

<img src="https://raw.githubusercontent.com/ChoonXiangg/SOC-Project/refs/heads/main/docs/assets/images/Code%20(3).png">

After that, I drew the red bottom part of the hat by filling the middle to lower part of the hat red. 

<img src="https://raw.githubusercontent.com/ChoonXiangg/SOC-Project/refs/heads/main/docs/assets/images/Code%20(4).png">

Finally, I drew the brim of the hat by filling a dark yellow rectangle at the bottom part of the hat.

if ((row - eyeYCenter) * (row - eyeYCenter) + (col - leftEyeXCenter) * (col - leftEyeXCenter) < eyeRadius * eyeRadius || (row - eyeYCenter) * (row - eyeYCenter) + (col - rightEyeXCenter) * (col - rightEyeXCenter) < eyeRadius * eyeRadius) begin

<img src="https://raw.githubusercontent.com/ChoonXiangg/SOC-Project/refs/heads/main/docs/assets/images/Code%20(5).png">

After that, I drew its eyes and its nose. It's just three black circles and since I knew how to draw a circle, it was quite simple.

<img src="https://raw.githubusercontent.com/ChoonXiangg/SOC-Project/refs/heads/main/docs/assets/images/Final%20Code.png">

This is my final edited code.
### **Simulation**

### **Synthesis**

### **Demonstration**
This is my final demonstration.
### **References**
ChatGPT for explanations.
M. Lynch, “System On Chip Design and Verification”, Labs, ATU, Galway, 2024.
